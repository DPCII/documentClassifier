US stocks end turbulent week with broad gains