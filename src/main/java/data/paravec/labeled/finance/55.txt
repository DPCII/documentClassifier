US stocks end mostly up as Tesla, Microsoft gain